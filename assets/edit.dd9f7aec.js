import{i as N,_ as V,o as w,c as b,a as t,u as E,s as z,e as T,f as j,j as p,v as k,h as r,k as I,l as O,b as B,F as D,m as P,t as v}from"./index.292d036b.js";import{u as q}from"./index.7ddc4e06.js";import{u as A,s as G,a as J}from"./useRecord.99885b04.js";function K(){const e=N({starttime:0,endtime:0,filterName:""}),o=N([]);return{newFilter:e,removeFilter:function(i){const u=o.findIndex(d=>d.id===i);o.splice(u,1)},filters:o,setFilters:function(){e.id=o.length+1,o.push(Object.assign({},e)),o.sort((i,u)=>Number(i.starttime)-Number(u.starttime))}}}const F=30;let _=0,g,x=!1,a="";function $(e,o,c){_++,e.currentTime=_/F;const l=Math.floor(_/F);if(o.forEach(i=>{l==i.starttime&&!a.includes(i.filterName)&&(a.includes("none")?a=i.filterName:a+=` ${i.filterName}`),l==i.endtime&&a.includes(i.filterName)&&(a=a.replace(`${i.filterName}`,"").trim()||"none")}),g.filter=a,l>=e.duration||x)return M(c);g.drawImage(e,0,0,480,360),setTimeout(()=>{$(e,o,c)},33)}const R=function(e,o,c,l){if(_=0,a="",x=!1,e.width=480,e.height=360,g=e.getContext("2d"),$(o,c,l),l)return l(!0)},M=function(e){if(_=0,x=!0,e)return e(!1)},Q={},W={height:"137px",style:{"enable-background":"new 0 0 98 137"},version:"1.1",viewBox:"0 0 98 137",width:"98px","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},X=t("defs",null,null,-1),Y=t("path",{d:"M75.6,44.8v73c0,3.4-2.8,6.2-6.2,6.2H21.3c-3.4,0-6.2-2.8-6.2-6.2v-73H75.6L75.6,44.8z M59.9,52.9v62.8h3.6V52.9H59.9  L59.9,52.9z M43.6,52.9v62.8h3.6V52.9H43.6L43.6,52.9z M27.3,52.9v62.8h3.6V52.9H27.3L27.3,52.9z M31.3,27.9v-5.2  c0-3.3,2.6-5.9,5.9-5.9h16.4c3.3,0,5.9,2.6,5.9,5.9v5.2h18.1c3.4,0,6.2,2.8,6.2,6.2v4.3H7V34c0-3.4,2.8-6.2,6.2-6.2H31.3L31.3,27.9z   M37.2,20.8c-1,0-1.8,0.8-1.8,1.8v5.2h20.1v-5.2c0-1-0.8-1.8-1.8-1.8H37.2L37.2,20.8z"},null,-1),Z=t("rect",{fill:"none",height:"137",id:"_x3C_Slice_x3E__100_",width:"98"},null,-1),tt=[X,Y,Z];function et(e,o){return w(),b("svg",W,tt)}const nt=V(Q,[["render",et]]),st=t("h2",null,"\u7B2C\u4E09\u6B65",-1),ot={class:"container center"},lt=t("p",null,"\u7DE8\u8F2F\u4F60\u7684\u6A94\u6848~",-1),it={class:"flex gap-4 w-full mb-4"},rt={class:"w-full"},at=t("span",null,"\u958B\u59CB\u6642\u9593",-1),ct=t("span",null,"\u7D50\u675F\u6642\u9593",-1),dt={class:"mb-6"},ut=t("span",null,"\u9078\u64C7\u6FFE\u93E1",-1),mt=t("option",{value:"grayscale(80%)"},"\u9ED1\u767D\u6548\u679C",-1),_t=t("option",{value:"blur(4px)"},"\u6A21\u7CCA",-1),ft=[mt,_t],ht=t("button",{type:"submit"}," \u78BA\u8A8D ",-1),pt={class:"mb-4 w-full"},vt={class:"grid grid-title grid-style w-full"},wt=t("li",null,"\u9805\u76EE",-1),bt=t("li",null,"\u6FFE\u93E1\u540D\u7A31",-1),gt=t("li",null,"\u958B\u59CB\u6642\u9593",-1),xt=t("li",null,"\u7D50\u675F\u6642\u9593",-1),yt={class:"w-full grid-wrap"},Lt=["onClick"],Nt={class:"btn-wrap"},Mt={__name:"edit",setup(e){const o=q();E();const{videoBlob:c}=z(o),l=T("canvas"),{blob:i,setBlob:u}=A(),{newFilter:d,removeFilter:S,filters:f,setFilters:y}=K(),h=document.createElement("video");c.value&&(h.load(),h.src=(window.webkitURL||window.URL).createObjectURL(c.value));function L(m){m==="start"?R(l.value,h,f):m==="stop"&&M()}async function U(m){if(!m){await J(u);const n=document.createElement("a");n.href=(window.webkitURL||window.URL).createObjectURL(i.value),n.download="video.webm",n.click()}}async function C(){await G(l.value.captureStream(60)),R(l.value,h,f,U)}return(m,n)=>(w(),b("div",null,[st,t("div",ot,[lt,t("main",it,[t("div",null,[t("canvas",{ref_key:"canvas",ref:l,width:"480",height:"270"},null,512)]),t("div",rt,[t("form",{onSubmit:n[3]||(n[3]=j((...s)=>r(y)&&r(y)(...s),["prevent"])),class:"h-full"},[t("label",null,[at,p(t("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>r(d).starttime=s),type:"number"},null,512),[[k,r(d).starttime]])]),t("label",null,[ct,p(t("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>r(d).endtime=s),type:"number"},null,512),[[k,r(d).endtime]])]),t("label",dt,[ut,p(t("select",{"onUpdate:modelValue":n[2]||(n[2]=s=>r(d).filterName=s)},ft,512),[[I,r(d).filterName]])]),ht],32)])]),p(t("div",pt,[t("ul",vt,[wt,bt,gt,xt,t("li",null,[B(nt,{width:"20px",height:"20px"})])]),t("ul",yt,[(w(!0),b(D,null,P(r(f),(s,H)=>(w(),b("li",{key:s.id,class:"grid"},[t("p",null,v(H+1),1),t("p",null,v(s.filterName),1),t("p",null,v(s.starttime),1),t("p",null,v(s.endtime),1),t("button",{onClick:kt=>r(S)(s.id)}," \u79FB\u9664 ",8,Lt)]))),128))])],512),[[O,r(f).length]]),t("div",Nt,[t("button",{onClick:n[4]||(n[4]=s=>L("start"))},"\u64AD\u653E"),t("button",{onClick:n[5]||(n[5]=s=>L("stop"))},"\u66AB\u505C"),t("button",{onClick:C},"\u4E0B\u8F09")])])]))}};export{Mt as default};
