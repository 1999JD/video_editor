import{i as k,_ as E,o as b,c as g,a as t,u as T,s as z,e as j,f as I,j as v,v as F,h as a,k as O,l as B,b as D,F as P,m as q,t as w,n as A}from"./index.42effce7.js";import{u as G}from"./index.64bb1697.js";import{u as J,s as K,a as Q}from"./useRecord.bbf377a6.js";function W(){const n=k({starttime:0,endtime:0,filterName:""}),i=k([]);return{newFilter:n,removeFilter:function(e){const m=i.findIndex(x=>x.id===e);i.splice(m,1)},filters:i,setFilters:function(){n.id=i.length+1,i.push(Object.assign({},n)),i.sort((e,m)=>Number(e.starttime)-Number(m.starttime))}}}const R=30;let _=0,r,N=!1,u="";function $(n,i,c){_++,n.currentTime=_/R;const l=Math.floor(_/R);if(i.forEach(e=>{e.filterName!=="flip"&&l==e.starttime&&!u.includes(e.filterName)&&(u.includes("none")?u=e.filterName:u+=` ${e.filterName}`),e.filterName!=="flip"&&l==e.endtime&&u.includes(e.filterName)&&(u=u.replace(`${e.filterName}`,"").trim()||"none"),l==e.starttime&&e.filterName==="flip"&&(r.setTransform(1,0,0,1,0,0),r.translate(480,0),r.scale(-1,1)),l==e.endtime&&e.filterName==="flip"&&(r.setTransform(1,0,0,1,0,0),r.translate(0,0),r.scale(1,1))}),r.filter=u,l>=n.duration||N)return M(c);r.drawImage(n,0,0,480,360),setTimeout(()=>{$(n,i,c)},33)}const S=function(n,i,c,l){if(_=0,u="",N=!1,n.width=480,n.height=360,r=n.getContext("2d"),$(i,c,l),l)return l(!0)},M=function(n){if(_=0,N=!0,n)return n(!1)},X={},Y={height:"137px",style:{"enable-background":"new 0 0 98 137"},version:"1.1",viewBox:"0 0 98 137",width:"98px","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Z=t("defs",null,null,-1),tt=t("path",{d:"M75.6,44.8v73c0,3.4-2.8,6.2-6.2,6.2H21.3c-3.4,0-6.2-2.8-6.2-6.2v-73H75.6L75.6,44.8z M59.9,52.9v62.8h3.6V52.9H59.9  L59.9,52.9z M43.6,52.9v62.8h3.6V52.9H43.6L43.6,52.9z M27.3,52.9v62.8h3.6V52.9H27.3L27.3,52.9z M31.3,27.9v-5.2  c0-3.3,2.6-5.9,5.9-5.9h16.4c3.3,0,5.9,2.6,5.9,5.9v5.2h18.1c3.4,0,6.2,2.8,6.2,6.2v4.3H7V34c0-3.4,2.8-6.2,6.2-6.2H31.3L31.3,27.9z   M37.2,20.8c-1,0-1.8,0.8-1.8,1.8v5.2h20.1v-5.2c0-1-0.8-1.8-1.8-1.8H37.2L37.2,20.8z"},null,-1),et=t("rect",{fill:"none",height:"137",id:"_x3C_Slice_x3E__100_",width:"98"},null,-1),nt=[Z,tt,et];function st(n,i){return b(),g("svg",Y,nt)}const ot=E(X,[["render",st]]),it=t("h2",null,"\u7B2C\u4E09\u6B65",-1),lt={class:"container center"},at=t("p",null,"\u7DE8\u8F2F\u4F60\u7684\u6A94\u6848~",-1),rt={class:"flex gap-4 w-full mb-4"},ut={class:"w-full"},ct=t("span",null,"\u958B\u59CB\u6642\u9593",-1),dt=t("span",null,"\u7D50\u675F\u6642\u9593",-1),mt={class:"mb-6"},pt=t("span",null,"\u9078\u64C7\u6FFE\u93E1",-1),_t=A('<option value="grayscale(70%)">\u9ED1\u767D\u6548\u679C</option><option value="blur(4px)">\u6A21\u7CCA</option><option value="brightness(0.5)">\u8B8A\u6697</option><option value="brightness(2)">\u8B8A\u4EAE</option><option value="invert(100%)">\u8CA0\u7247</option><option value="sepia(100%)">\u6CDB\u9EC3</option><option value="flip">\u7FFB\u8F49</option>',7),ft=[_t],ht=t("button",{type:"submit"}," \u78BA\u8A8D ",-1),vt={class:"mb-4 w-full"},wt={class:"grid grid-title grid-style w-full"},bt=t("li",null,"\u9805\u76EE",-1),gt=t("li",null,"\u6FFE\u93E1\u540D\u7A31",-1),xt=t("li",null,"\u958B\u59CB\u6642\u9593",-1),Nt=t("li",null,"\u7D50\u675F\u6642\u9593",-1),yt={class:"w-full grid-wrap"},Lt=["onClick"],kt={class:"btn-wrap"},Mt={__name:"edit",setup(n){const i=G(),c=T(),{videoBlob:l}=z(i),e=j("canvas"),{blob:m,setBlob:x}=J(),{newFilter:d,removeFilter:H,filters:f,setFilters:y}=W(),h=document.createElement("video");l.value?(h.load(),h.src=(window.webkitURL||window.URL).createObjectURL(l.value)):c.push({name:"Home"});function L(p){p==="start"?S(e.value,h,f):p==="stop"&&M()}async function U(p){if(!p){await Q(x);const s=document.createElement("a");s.href=(window.webkitURL||window.URL).createObjectURL(m.value),s.download="video.webm",s.click()}}async function V(){await K(e.value.captureStream(60)),S(e.value,h,f,U)}return(p,s)=>(b(),g("div",null,[it,t("div",lt,[at,t("main",rt,[t("div",null,[t("canvas",{ref_key:"canvas",ref:e,width:"480",height:"270"},null,512)]),t("div",ut,[t("form",{onSubmit:s[3]||(s[3]=I((...o)=>a(y)&&a(y)(...o),["prevent"])),class:"h-full"},[t("label",null,[ct,v(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>a(d).starttime=o),type:"number"},null,512),[[F,a(d).starttime]])]),t("label",null,[dt,v(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>a(d).endtime=o),type:"number"},null,512),[[F,a(d).endtime]])]),t("label",mt,[pt,v(t("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>a(d).filterName=o)},ft,512),[[O,a(d).filterName]])]),ht],32)])]),v(t("div",vt,[t("ul",wt,[bt,gt,xt,Nt,t("li",null,[D(ot,{width:"20px",height:"20px"})])]),t("ul",yt,[(b(!0),g(P,null,q(a(f),(o,C)=>(b(),g("li",{key:o.id,class:"grid"},[t("p",null,w(C+1),1),t("p",null,w(o.filterName),1),t("p",null,w(o.starttime),1),t("p",null,w(o.endtime),1),t("button",{onClick:Ft=>a(H)(o.id)}," \u79FB\u9664 ",8,Lt)]))),128))])],512),[[B,a(f).length]]),t("div",kt,[t("button",{onClick:s[4]||(s[4]=o=>L("start"))},"\u64AD\u653E"),t("button",{onClick:s[5]||(s[5]=o=>L("stop"))},"\u66AB\u505C"),t("button",{onClick:V},"\u4E0B\u8F09")])])]))}};export{Mt as default};
